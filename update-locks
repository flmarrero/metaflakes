#!/usr/bin/env bash

set -euo pipefail

ROOT_DIR="${1:-.}"

find "$ROOT_DIR" -type f -name "flake.nix" | while read -r flake_file; do
    flake_dir=$(dirname "$flake_file")
    echo "Updating flake in: $flake_dir"

    (
        cd "$flake_dir"
        if nix flake update; then
            echo "Successfully updated: $flake_dir"
        else
            echo "Failed to update: $flake_dir" >&2
        fi
    )
done
